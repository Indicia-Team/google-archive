#summary Quick guide to installing the Indicia Warehouse
#labels Phase-Deploy

= Installation =

This guide is a quick summary of the steps required to install the Indicia Warehouse.

Note that if you are installing Indicia onto a hosted shared server, the chances are you will not have the full privileges required to setup the PostGIS database and PHP settings (if required). It may be helpful to ask your web host to perform the steps *Install PostgreSQL and PostGIS* to check that the pgsql and cURL extensions are enabled for PHP as described in the section *Install PHP and a Web Server*.

== Install PostgreSQL and PostGIS ==

First, install the PostgreSQL database server and the PostGIS extension for your operating system. For downloads and more information see [http://www.postgresql.org/] and [http://postgis.refractions.net/]. Note that if you are installing on Windows, version 8.3 of PostgreSQL allows you to install PostGIS by using the Stack Builder tool included with PostgreSQL.

Next, create a PostGIS database on your server. You don't need to put any content in the database yet. You can do this using the pgAdmin tool supplied with PostgreSQL and running the following SQL script against the postgres database, which creates a PostGIS database called *indicia*.
{{{
CREATE DATABASE indicia TEMPLATE=template_postgis;
}}}
A word of warning. After choosing the 'Server' from the left hand pane within pgAdmin, a list of existing databases will be displayed for that server, including the 'template_postgis'. One of these databases will be opened by default - unfortunately for a blank installation this will be the 'template_postgis' database as there are no others. In order for the above statement to work, this must not be active (i.e. it must have a red cross over its icon) - pgAdmin will complain that another user (in this case itself) has the template database open. In this case, the problem may be circumvented by creating a blank database with no template (e.g. called 'X'), shutting down pgAdmin, and then restarting it. On reopening the relevant server, the dummy database should be active, and the 'template_postgis' one not. The above statement should now be able to be run without issue. The dummy database may then be deleted.

You can use the postgres super-user account to run Indicia if you like, which is the easiest but least secure method. Assuming you want to create your own user to run Indicia, run the following script to create the user and add it to the database, changing the username, password and database name as required:
{{{
CREATE USER indicia_user WITH PASSWORD 'indicia';
GRANT ALL PRIVILEGES ON DATABASE indicia TO indicia_user;
}}}

Now, connect your query tool to the new indicia database, and run the following script which allows the Indicia user just enough rights to access the PostGIS functionality:
{{{
GRANT ALL PRIVILEGES ON TABLE geometry_columns TO indicia_user;
GRANT ALL PRIVILEGES ON TABLE spatial_ref_sys TO indicia_user;
GRANT EXECUTE ON FUNCTION st_astext(geometry) TO indicia_user;
GRANT EXECUTE ON FUNCTION st_geomfromtext(text, integer) TO indicia_user;
GRANT EXECUTE ON FUNCTION st_transform(geometry, integer) TO indicia_user;
}}}

== Install PHP and a web server ==

There are many tutorials on the web on how to install PHP and a webserver such as Apache. PHP version 5 is required. For example, the following guide explains installation of PHP, Apache and MySQL on Windows: [http://www.php-mysql-tutorial.com/install-apache-php-mysql.php]. MySQL is not required by the Indicia Warehouse.

After installing PHP, edit your php.ini file and uncomment the following two lines by removing the semi-colon at the start. This enables the pgsql module required for PHP to access the PostgreSQL database, and the cURL module which the demonstration site pages use to access the web services. After you've changed and saved the file, restart your Apache web server.
{{{
extension=php_curl.dll
extension=php_pgsql.dll
}}}

Once you have done this, it's a good idea to check that the cURL and pgsql libraries have been installed successfully for PHP. You can do this by creating a file called phpinfo.php in the root html directory of your webserver, and editing it with a text editor. Enter the following text into the file and save it:
{{{
<?php echo phpinfo(); ?>
}}}

Now go to a web browser, and enter the root of your webserver followed by phpinfo.php (e.g
http://localhost/phpinfo.php). The page you see should detail your PHP configuration, and if you look down the page you should see that the cURL and pgsql libraries are loaded.

_Tip: If you have installed PHP 5.2.6 and the pgsql library won't load, this may be because of a bug in this release of PHP making it incompatible with the version of PostgreSQL you have installed. To fix this, you will need to replace the file php_pgsql.dll in your PHP installation with the version from the PHP 5.2.5 download, and also replace the file libpq.dll from your PostgreSQL install folder with the one from this download._

== Install subversion ==

To access the source code, you need a SubVersion command-line client installed. See [http://subversion.tigris.org/].

== Grab the source code ==

First, create yourself a folder inside your Apache root (htdocs) folder, for example htdocs\indicia. Now, run the following command line from the Apache root folder to grab the source code into the folder you created:
`svn checkout http://indicia.googlecode.com/svn/core/trunk/ indicia`

If you are running on a hosted server, it may be easiest to grab the code into a local folder then use an FTP tool to upload it into a folder created on your web server account.

== Run the Setup ==

The Setup procedure will automatically start if you access the index.php file in the root of the website. So, just enter this into your web browser, for example //localhost/indicia/index.php, and load the page. This should display the Indicia Setup Check page, which with any luck will show the following information:

http://indicia.googlecode.com/svn/wiki/setup_check.png

Each of the tasks that the Indicia Warehouse has identified still needs your attention are listed on this page in a warning box. Assuming that you have enabled the cUrl and PostgreSQL PHP extensions earlier in this guide and that an appropriate version of PHP is installed (at least 5.2), then the things you will need to attend to are as follows:

===Directory Access===

If your server is a production server then you should ensure that each folder has the required permissions, and no more. This section of the setup check gives you some pointers to the permission problems that currently exist. Once you have corrected them you can refresh the page to check that it has worked. 

If you are installing a server for development purposes and want to ignore this, click the Acknowledge button and confirm this on the next screen to allow you to proceed with the installation.

===Demo configuration===

Click the Configure Demo Pages button, then you will be presented with the Demo Configuration page:

http://indicia.googlecode.com/svn/wiki/setup_demo.png

This page allows you to provide a link to a [http://geoserver.org GeoServer] installation on your server which can provide access to the spatial data in your Warehouse. If you don't have one, don't worry as this is only required for some distribution mapping functionality and can be added later. 

In addition, this page allows you to specify API keys for various web services used by the Indicia demo pages. If you don't specify them now, they can be entered later by editing the file client_helpers/helper_config.php.

===Email Configuration===

Click the Configure email button, then you will be presented with the Email Configuration page:

http://indicia.googlecode.com/svn/wiki/setup_email.png

On this page, you need to provide the information Indicia needs to connect to a mail server in order to send forgotten password reminder emails. If you are running a development server or don't need this functionality, you can click the Skip email configuration button.

===Database Configuration===

Click the Configure database button, then you will be presented with the Database Configuration page:

http://indicia.googlecode.com/svn/wiki/setup_db.png

Specify the name of the database you have created, plus the username and password of the user you created earlier. You will also be asked to enter a schema name - typically you can enter "indicia" as the schema name but if you need to run more than one Indicia warehouse on a single PostgreSQL database you can use another name.

The Host and Port can be left at their default settings if PostgreSQL is running on the local machine on the default port.

Once done, just click the Submit button. It will take a few seconds to return to the Setup Check page now because the database itself is being installed and prepared for use.

Once you have done all the setup tasks required, you will see the following:

http://indicia.googlecode.com/svn/wiki/setup_complete.png

== Test it ==

If everything has worked, clicking the button on the message will take you to the login page for the Indicia Warehouse Module. The initial login username is admin, with no password, but after logging in you will be immediately taken to the page that requests you to change your password.

That's it!

== Next Steps ==

In order to get the demonstration pages up and running now that you have installed the Indicia Warehouse, take a look at [DemoSiteModuleInstallation Installing the demonstration site module].