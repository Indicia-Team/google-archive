<?xml version="1.0" encoding="UTF-8"?>
<report title="Survey Details" description="Details of all occurrences associated with a survey">
  <params>
    <param name='survey_id' display='Survey' description='Select the survey to return data for' datatype='lookup'
        population_call='direct:survey:id:title'/>
  </params>
  <table tablename="samples" where="#this#.survey_id = #survey_id# and #this#.deleted = FALSE " >
    <tabColumn name='id' display='ID' />
      <subTable tablename="locations" where="#this#.deleted = FALSE" >
        <tabColumn name='name' display='Site' />
      </subTable>
    <tabColumn name='date_start' />
    <tabColumn name='date_end' />
    <tabColumn name='date_type' />
    <tabColumn name='date' func="''" display='Date' />
    <tabColumn name='entered_sref' display='Grid Ref' />
    <tabColumn name='geom' func='st_astext(st_transform(#this#.geom,4326))' visible='false' />
    <tabColumn name='comment' display='Comment' />
    <tabColumn name='external_key' display='External key' />
    <subTable tablename='termlists_terms' parentKey='sample_method_id' where=" #this#.deleted = FALSE" >
      <subTable tablename='terms' where="#this#.deleted = FALSE and #this#.term='TreeVisit'" >
        <tabColumn name='term' display='Sample Method' visible='false' />
      </subTable>
    </subTable>
    <attributes  separator='|' />
  </table>
</report>
