  <report
    title="Count Units Review - Unverified"
    description="A list of Count Unit Boundaries which are not set as the preferred boundary."
>
  <query website_filter_field="lw.website_id">
    SELECT #columns#
       FROM locations cub
         LEFT JOIN locations_websites lw ON lw.location_id=cub.id
         LEFT JOIN location_attribute_values lavPreferred ON lavPreferred.int_value=cub.id AND lavPreferred.location_attribute_id=#preferred_attribute_id# and lavPreferred.deleted = false
         LEFT JOIN location_attribute_values lavStartDate ON lavStartDate.location_id=cub.id AND lavStartDate.location_attribute_id=#count_unit_boundary_start_date_id# and lavStartDate.deleted = false
         LEFT JOIN location_attribute_values lavEndDate ON lavEndDate.location_id=cub.id AND lavEndDate.location_attribute_id=#count_unit_boundary_end_date_id# and lavEndDate.deleted = false
    WHERE cub.deleted = false AND lw.deleted = false
    AND cub.location_type_id=#count_unit_boundary_type_id#
    AND (lavPreferred.int_value is null)
  </query>
  <params>
    <param name="preferred_attribute_id" datatype="integer"/>
    <param name="count_unit_boundary_type_id" datatype="integer"/>
    <param name="count_unit_boundary_start_date_id" datatype="integer"/>
    <param name="count_unit_boundary_end_date_id" datatype="integer"/>
  </params>
  <columns>
    <column name="id" display="Count Unit Boundary Id" sql="cub.id" in_count="true"/> 
    <column name="start_date" display="Count Unit Boundary Start Date" sql="to_char(lavStartDate.date_start_value, 'DD/MM/YYYY')" /> 
    <column name="end_date" display="Count Unit Boundary End Date" sql="to_char(lavEndDate.date_start_value, 'DD/MM/YYYY')" /> 
  </columns>
</report>

