<report
    title="MNHNL Location Search 1"
    description="Form Internal Report: To be used when searching locations for attributes which match a value: index one, which means second attribute."
>
<query>
  SELECT lav2.text_value attr_value2,
         count(*) count
  FROM locations l
  LEFT JOIN location_attribute_values lav2 ON lav2.location_id = l.id and lav2.deleted = FALSE and lav2.location_attribute_id = #location_attr_2_id#
  WHERE EXISTS (SELECT 1 from location_attribute_values lav1 WHERE lav1.location_id = l.id and lav1.deleted = FALSE and lav1.text_value = '#location_attr_1_value#' and lav1.location_attribute_id = #location_attr_1_id#)
  AND l.location_type_id = #location_type_id#
  GROUP BY lav2.text_value
  ORDER BY lav2.text_value
  </query>
  <params>
    <param name='location_type_id' display='Location Type ID' description='Location Type ID' datatype='int' />
    <param name='location_attr_1_id' display='Location Attribute ID 1' description='Location Attribute ID' datatype='int' />
    <param name='location_attr_1_value' display='Location Attribute Value 1' description='Location Attribute Value' datatype='text' />
    <param name='location_attr_2_id' display='Location Attribute ID 2' description='Location Attribute ID' datatype='int' />
  </params>
</report>
