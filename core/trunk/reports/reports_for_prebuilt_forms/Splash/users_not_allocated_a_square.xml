<report
    title="Unallocated Squares"
    description="A list of users who have not been allocated a square yet ordered by the date they registered"
>
  <query website_filter_field="uw.website_id">
  SELECT #columns#
  FROM users u  
    JOIN users_websites uw on u.id=uw.user_id  
    LEFT JOIN person_attribute_values pav on pav.person_attribute_id=#user_square_attr_id# AND pav.person_id=u.person_id AND pav.deleted=false
    LEFT JOIN people p on p.id = u.person_id 
  WHERE u.deleted=false AND p.deleted=false AND pav.id IS NULL
  AND #website_filter#
  </query>
  <order_bys>
    <order_by>u.created_on ASC</order_by>
  </order_bys>
  <params>
    <param name='user_square_attr_id' display='Id of the person attribute that holds user squares' description='' datatype='integer'/>
  </params>
  <columns> 
    <column name='id' sql='u.id' datatype='integer' visible='false'/>
    <column name='username' sql='u.username' display='Username' datatype='text'/>
    <column name="person_name" display="User's Name" sql="p.first_name || ' ' || p.surname" datatype="text"/>
    <column name="registered" display="Registered" sql="u.created_on" datatype="date"/>
  </columns>
</report>