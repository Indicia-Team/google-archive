<?xml version="1.0" encoding="UTF-8"?>

<report title="SRF2 Download Samples" description="Details of all occurrances associated with closed samples">
      <params>
            <param name="download" display="Download" description="Carry out as a download... Downloaded records are set to read only."
            	datatype='lookup' lookup_values='OFF:No,INITIAL:sweep up all records,CONFIRM:Final but dont mark records,FINAL:Final + mark records' />
            <param name="closed_id" display="closed_id" description="ID of Closed sample attribute" datatype='int' />
      </params>
      <vagueDate enableProcessing='true' /> // in this case value picked up from parameter, though can be set explicitly as well.
      <download mode="#download#" /> // in this case value picked up from parameter, though can be set explicitly as well.
      <table tablename="samples" where="#this#.deleted = FALSE and #this#.parent_id IS NULL" >
		  <subTable tablename="locations" where="#this#.deleted = FALSE" >
			<tabColumn name='name' display='Transect'/>
		  </subTable>
		  <subTable tablename="sample_attribute_values" parentKey="id" where="#this#.deleted = FALSE and #this#.int_value = 1 and #this#.sample_attribute_id = #closed_id#" >
		  </subTable>
 		  <tabColumn name='date_start' visible='false'/>
		  <tabColumn name='date_end' visible='false'/>
		  <tabColumn name='date_type' visible='false'/>
		  <tabColumn name='date' func="''"/> // dummy field for the vague date processing, here so appears at logical position and with reasonable description in the report
          <attributes separator='|' />
 		  <subTable tablename="samples" parentKey="parent_id" where="#this#.deleted = FALSE" >
		    <tabColumn name='entered_sref' display='Spatial Reference'/>
		    <tabColumn name='entered_sref_system'  display='SRef System'/>
            <subTable tablename="occurrences" parentKey="id" where=" #this#.deleted = FALSE" >
				<subTable tablename='taxa_taxon_lists' where="#this#.deleted = FALSE" >
		      		<subTable tablename='taxa' where="#this#.deleted = FALSE" >
		    	    	<tabColumn name='taxon' />
		      		</subTable>
		    	</subTable>
            	<attributes separator='|' /> 
		    	<tabColumn name='comment' />
          	</subTable>    
          </subTable>    
      </table>
</report>
