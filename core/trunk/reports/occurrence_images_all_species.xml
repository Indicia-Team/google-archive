<report
    title="Occurrence images for any species"
    description="Lists the images uploaded for occurrences for any species."
    row_class="biota"
>
  <query>
  SELECT su.title, su.website_id, o.id as occurrence_id, oi.id as occurrence_image_id, s.date_start, s.date_end, s.date_type, lttl.taxon, 
  s.entered_sref, COALESCE(l.name, s.location_name) as location_name, oi.path, oi.caption, lttl.external_key,
  CASE o.record_status 
    WHEN 'C' THEN 'Data Entry Complete' 
    WHEN 'V' THEN 'Verified'
    WHEN 'R' THEN 'Rejected'
    WHEN 'I' THEN 'In Progress'
    WHEN 'T' THEN 'Test'
    WHEN 'S' THEN 'Sent for verification'
    ELSE ''
  END AS record_status,
  u.username as verified_by
  FROM samples s
  JOIN occurrences o ON o.sample_id=s.id AND o.deleted = false
  JOIN occurrence_images oi ON oi.occurrence_id=o.id AND oi.deleted = false
  JOIN surveys su ON s.survey_id = su.id AND su.deleted = false
  JOIN list_taxa_taxon_lists lttl ON lttl.id=o.taxa_taxon_list_id
  LEFT JOIN locations l ON l.id=s.location_id 
  LEFT JOIN users u ON u.id=o.verified_by_id
  WHERE lttl.taxon_list_id = #taxon_list_id#
  AND o.record_status NOT IN ('I','T')
  AND s.deleted = false
  #order_by#
  </query>
  <order_bys>
    <order_by>date_start DESC</order_by>
  </order_bys>
  <params>
    <param name='taxon_list_id' display='Taxon list' description='Checklist to look in' datatype='lookup'
        query='SELECT id, title as caption FROM taxon_lists' population_call='direct:taxon_list:id:title' />
  </params>
  <columns>
    <column name='path' display='Photo' img='true' />
    <column name='caption' display='Photo Caption'/>
    <column name='title' display='Survey' />
    <column name='website_id' visible='false' />
    <column name='occurrence_id' visible='false' />
    <column name='occurrence_image_id' visible='false' />
    <column name='date' display='Date' orderby='date_start' />
    <column name='taxon' display='Taxon' class='sci binomial' />
    <column name='entered_sref' display='Spatial Ref.' />
    <column name='location_name' display='Location' />
    <column name='record_status' display='Record Status' />
    <column name='verified_by' display='Verified By' />
  </columns>
</report>